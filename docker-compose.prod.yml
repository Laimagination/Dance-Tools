services:
  app:
    image: ghcr.io/YOUR_GITHUB_USERNAME/dance-studio-tools:latest
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.dancestudio.rule=Host(`yourdomain.com`) || Host(`www.yourdomain.com`)"
      - "traefik.http.routers.dancestudio.entrypoints=websecure"
      - "traefik.http.routers.dancestudio.tls.certresolver=letsencrypt"
      - "traefik.http.services.dancestudio.loadbalancer.server.port=3000"
      # Redirect www to non-www
      - "traefik.http.middlewares.dancestudio-redirect.redirectregex.regex=^https://www\\.yourdomain\\.com/(.*)"
      - "traefik.http.middlewares.dancestudio-redirect.redirectregex.replacement=https://yourdomain.com/$${1}"
      - "traefik.http.routers.dancestudio.middlewares=dancestudio-redirect"
      # Watchtower auto-update
      - "com.centurylinklabs.watchtower.enable=true"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
      - NEXTAUTH_URL=https://yourdomain.com
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET}
      - STRIPE_PRO_PRICE_ID=${STRIPE_PRO_PRICE_ID}
      - NEXT_PUBLIC_APP_URL=https://yourdomain.com
      - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=${NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY}
    restart: unless-stopped
    networks:
      - traefik-public

networks:
  traefik-public:
    external: true
